---
title: "MetaboExploreR CCSM Workflow"
author: "Harrison Szemray"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
---

```{r Single project workflow, include = FALSE}
# User parameters:
project_path <- "USER/PATH/TO/PROJECT" # Please define path to project file
qc_label <- "LTR"   # Options: LTR, PQC, VLTR, etc.
missing_val_threshold <- 50 #default for ANPC methods

start <- Sys.time()
message("Step 1: Converting raw vendor files to mzml...")
MetaboExploreR::msConvertR(
  input_directory  = project_path,
  output_directory = project_path
)
end_msconvert <- Sys.time()
message("Step 2: Running PeakForgeR...")
MetaboExploreR::PeakForgeR(
  user_name = "ANPC",
  project_directory = project_path,
  mrm_template_list = NULL,
  QC_sample_label = qc_label,
  plateID_outputs = NULL
)
end_peakforge <- Sys.time()
message("Step 3: Running QC check...")
MetaboExploreR::qcCheckR(
  user_name = "ANPC",
  project_directory = project_path,
  mrm_template_list = NULL,
  QC_sample_label = qc_label,
  sample_tags = NULL,
  mv_threshold = missing_val_threshold
)
end_qccheck <- Sys.time()

print("msconvert:", end_msconvert - start)
print("peakforge:", end_peakforge - end_msconvert)
print("qccheck:", end_qccheck - end_peakforge)
print("total run time:", end_qccheck - start)

sessionInfo()
```

```{r multiproject workflow, include = FALSE}
# Define a list of project configurations
project_configs <- list(
  list(path = "USER/PATH/TO/PROJECT1", qc_label = "PQC", missing_val_threshold = 50),
  list(path = "USER/PATH/TO/PROJECT2", qc_label = "LTR", missing_val_threshold = 40),
  list(path = "USER/PATH/TO/PROJECT3", qc_label = "VLTR", missing_val_threshold = 60)
)

#Loop through configs
for (config in project_configs) {
  project_path <- config$path
  qc_label <- config$qc_label
  missing_val_threshold <- config$missing_val_threshold

  message("Step 1: Converting raw vendor files to mzml...")
  MetaboExploreR::msConvertR(
    input_directory  = project_path,
    output_directory = project_path
  )

  message("Step 2: Running PeakForgeR...")
  MetaboExploreR::PeakForgeR(
    user_name = "ANPC",
    project_directory = project_path,
    mrm_template_list = NULL,
    QC_sample_label = qc_label,
    plateID_outputs = NULL
  )

  message("Step 3: Running QC check...")
  MetaboExploreR::qcCheckR(
    user_name = "ANPC",
    project_directory = project_path,
    mrm_template_list = NULL,
    QC_sample_label = qc_label,
    sample_tags = NULL,
    mv_threshold = missing_val_threshold
  )
}

sessionInfo()
```
